function input(){for(;;){var n=prompt("Please enter dice number (3 ~ 6)","");if(null===n)return null;try{var t=parseInt(n);if(t>=3&&t<=6)return t}catch(n){console.error(n)}}}function inputAndPlay(){var n=input();null!==n&&play(n)}function setup(){round=0,balance=0,setTitle("Welcome");var n=[];n.push('<p>How to play:  First you are asked to enter the number of dice (between 3 and 6) that will be used in the game. Then you can play several rounds, in each round you will get a point which depends on the number of all the dices. Finally, when you click "End Game", you can see total balance and average points per round you get during the game.</p>'),n.push('<button onclick="inputAndPlay()">Go</button>'),setContent(n)}function setContent(n){document.getElementById("content").innerHTML=n.map(function(n){return'<div class="content-item">'+n+"</div>"}).join("")}function setTitle(n){document.getElementById("title").innerHTML=n}function sum(n){return n.reduce(function(n,t){return n+t},0)}function sortValues(n){return n.slice(0).sort(function(n,t){return n-t})}function getRandom(){return Math.floor(6*Math.random())+1}function getDices(n){for(var t=[],e=0;e<n;e++)t.push(getRandom());return t}function rollDices(n,t,e){function o(){var r=getDices(n);u>=20?(t(r),setTimeout(function(){e(r)},500)):(t(r),u++,i*=1.05,setTimeout(o,i))}var u=0,i=40;o()}function getDiceHTML(n){return'<div class="dice-container">'+n.map(function(n){return'<img class="dice" src="'+n+'.png">'}).join("")+"</div>"}function isSame(n){return n[0]===n[n.length-1]}function isSameNMinus1(n){var t=n.length-1;return n[0]===n[t-1]&&n[0]!==n[t]||n[1]===n[t]&&n[0]!==n[1]}function isARun(n){for(var t=1;t<n.length;t++)if(n[t]-n[0]!==t)return!1;return!0}function isAllDifferent(n){for(var t=1;t<n.length;t++)if(n[t]===n[t-1])return!1;return!0}function computePoint(n){var t=n.length,e=sortValues(n);return isSame(e)?{points:60+e[0]*t,bonus:60,type:"same"}:isSameNMinus1(e)?{points:40+sum(e),bonus:40,type:"same_n_minus_1"}:isARun(e)?{points:20+sum(e),bonus:20,type:"run"}:isAllDifferent(e)?{points:sum(e),bonus:0,type:"different"}:{points:0,bonus:0,type:"other"}}function showRoundResult(n,t){var e=computePoint(n);balance+=e.points;var o=[];o.push(getDiceHTML(n));var u="Points in this round: "+e.points;e.bonus>0&&(u+=" (with "+e.bonus+" bonus)"),u+=".",o.push(u),o.push("Total balance of points: "+balance+"."),o.push('<button onclick="play('+t+')">Try Again</button><button onclick="end()">End Game</button>'),setContent(o)}function play(n){setTitle("Round "+ ++round),rollDices(n,function(n){setContent([getDiceHTML(n)])},function(t){showRoundResult(t,n)})}function end(){setTitle("Congratulations");var n=[];n.push("You have played "+round+" round(s)."),n.push("Your total balance of points is "+balance+".");var t=0===round?0:(balance/round).toFixed(1);n.push("Average points per round is "+t+"."),n.push('<button onclick="setup()">Play Again</button>'),setContent(n)}var round=0,balance=0;setup();
